---
interface PaginationProps {
	translations: {
		previous: string;
		next: string;
	};
}

const { translations } = Astro.props;
---

<div 
	id="pagination-container" 
	class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-4"
	data-previous={translations.previous}
	data-next={translations.next}
>
</div>

<script>
	import { paginationState } from '@/stores/pagination-state';

	(window as any).paginationState = paginationState;

	/**
	 * Renders pagination UI based on current state.
	 * @param state - Current pagination state
	 */
	function renderPagination(state: { currentPage: number; totalPages: number; totalItems: number }) {
		const container = document.getElementById('pagination-container');
		
		if (!container) return;

		if (state.totalPages <= 1) {
			container.innerHTML = '';
			return;
		}

		const translations = {
			previous: container.dataset.previous || 'Previous',
			next: container.dataset.next || 'Next'
		};

		const maxButtons = 5;
		let startPage = Math.max(1, state.currentPage - 2);
		let endPage = Math.min(state.totalPages, startPage + maxButtons - 1);

		if (endPage - startPage < maxButtons - 1) {
			startPage = Math.max(1, endPage - maxButtons + 1);
		}

		const pageNumbers = [];
		for (let i = startPage; i <= endPage; i++) {
			pageNumbers.push(i);
		}

		const paginationHTML = `
			<div class="flex gap-2">
				<button
					id="prev-page"
					class="px-4 py-2 cursor-pointer rounded-lg bg-secondary text-secondary-foreground border border-border hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
					${state.currentPage === 1 ? 'disabled' : ''}
					aria-label="${translations.previous}"
				>
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
					</svg>
				</button>
				
				<div class="flex gap-1">
					${pageNumbers.map((pageNum: number) => `
						<button
							class="px-4 py-2 rounded-lg border transition-colors ${
								pageNum === state.currentPage
									? 'bg-primary text-primary-foreground border-primary'
									: 'bg-secondary text-secondary-foreground border-border hover:bg-accent'
							}"
							onclick="window.paginationState.goToPage(${pageNum})"
							aria-label="Go to page ${pageNum}"
							${pageNum === state.currentPage ? 'aria-current="page"' : ''}
						>
							${pageNum}
						</button>
					`).join('')}
				</div>
				
				<button
					id="next-page"
					class="px-4 py-2 cursor-pointer rounded-lg bg-secondary text-secondary-foreground border border-border hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
					${state.currentPage === state.totalPages ? 'disabled' : ''}
					aria-label="${translations.next}"
				>
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
					</svg>
				</button>
			</div>
		`;

		container.innerHTML = paginationHTML;

		const prevButton = document.getElementById('prev-page');
		const nextButton = document.getElementById('next-page');

		if (prevButton) {
			prevButton.addEventListener('click', () => {
				paginationState.previousPage();
			});
		}

		if (nextButton) {
			nextButton.addEventListener('click', () => {
				paginationState.nextPage();
			});
		}
	}

	/**
	 * Sets up keyboard navigation for pagination.
	 */
	document.addEventListener('keydown', (e: KeyboardEvent) => {
		if (e.key === 'ArrowLeft') {
			e.preventDefault();
			paginationState.previousPage();
		} else if (e.key === 'ArrowRight') {
			e.preventDefault();
			paginationState.nextPage();
		}
	});

	/**
	 * Subscribes to pagination state changes and re-renders UI.
	 */
	paginationState.subscribe((state: { currentPage: number; totalPages: number; totalItems: number }) => {
		renderPagination(state);
		if ((window as any).onPageChangeCallback) {
			(window as any).onPageChangeCallback(state.currentPage);
		}
	});

	/**
	 * Initializes pagination on DOM content loaded.
	 */
	document.addEventListener('DOMContentLoaded', () => {
		const initialState = {
			currentPage: paginationState.getCurrentPage(),
			totalPages: paginationState.getTotalPages(),
			totalItems: paginationState.getTotalItems()
		};
		renderPagination(initialState);
	});
</script>